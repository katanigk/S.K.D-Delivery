<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S.K.D – איסוף חבילות מחו"ל עד הבית</title>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <style>
    body {font-family:'Heebo',sans-serif;background:#f9f9f9;margin:0;padding:0;display:flex;justify-content:center;align-items:flex-start;min-height:100vh;}
    .container{background:white;padding:20px 30px;margin:30px;border-radius:8px;box-shadow:0 0 15px rgba(0,0,0,0.1);width:100%;max-width:500px;}
    h1{font-size:24px;margin-bottom:5px;}
    h2{font-size:16px;margin-bottom:15px;color:#444;}
    .notice{background:#fff3cd;color:#856404;padding:10px;border-radius:4px;margin-bottom:15px;font-weight:bold;text-align:center;}
    label{display:block;margin-top:10px;}
    input[type="text"],textarea{width:100%;padding:8px;margin-top:5px;border:1px solid #ccc;border-radius:4px;font-size:16px;}
    textarea{resize:vertical;}
    .checkbox-container{margin-top:10px;}
    .checkbox-container input{margin-left:10px;}
    .btn{display:block;margin:20px 0;background-color:#007bff;color:white;border:none;padding:12px;border-radius:4px;font-size:16px;cursor:pointer;width:100%;}
    .summary-box{background:#f1f1f1;padding:10px;border-radius:4px;margin-top:10px;white-space:pre-line;}
    .footer{text-align:justify;font-size:14px;margin-top:10px;color:#333;}
    .contact-line{text-align:center;margin-top:20px;font-size:14px;}
  </style>
</head>
<body>
  <div class="container">
    <h1>📦 S.K.D – איסוף חבילות מחו"ל עד הבית</h1>
    <h2>קיבלת הודעה על חבילה מחו"ל? אנחנו נאסוף עבורך מנקודת האיסוף ונביא עד הבית – ב־25 ₪ בלבד!</h2>

    <div class="notice">❗ השירות פעיל כרגע רק בשכונות אם המושבות, הדר המושבות, קרול ונווה גן בפתח תקווה ❗<br>
    ⏰ שעות פעילות: ימים א׳–ה׳, 09:00–17:00.<br>🏪 השירות ניתן בכפוף לשעות הפעילות של בית העסק בו נמצאת החבילה.</div>

    <p><strong>מחירון:</strong><br>
    איסוף חבילה – 25 ש"ח<br>
    חבילה נוספת מאותו מקום – 5 ש"ח<br>
    חבילה נוספת ממקום אחר – 15 ש"ח</p>

    <label>👤 שם מלא<input type="text" id="name" /></label>
    <label>📞 טלפון<input type="text" id="phone" /></label>
    <label>🏠 כתובת למשלוח<input type="text" id="address" /></label>

    <label>📝 הוראות מיוחדות לשליח
      <input type="text" id="extraInfo" placeholder="קוד כניסה, קומה, דירה, הערות חשובות..." />
    </label>

    <label>✉️ אימייל לקבלת חשבונית<input type="text" id="email" /></label>

    <label>📩 הדבק כאן את ההודעה מחברת השילוח</label>
    <textarea id="sms" placeholder="לדוגמה:
שלום ישראל ישראלי, משלוח Epost מיקום בחנות Hfd002742213 EP902308243 מחברת Cainiao ממתין לאיסופך. (מספר Epost 76025725). חנות: שוק בשכונה קוד לקבלת החבילה: 333857 בכתובת עין גנים 96 פתח תקווה...
📌 העתק את ההודעה שקיבלת ב-SMS מחברת השילוח והדבק כאן."></textarea>

    <div class="checkbox-container">
      <input type="checkbox" id="samePlace" /> יש לי חבילה נוספת מאותו מקום<br />
      <textarea id="sms2" placeholder="הודעת SMS נוספת (מאותו מקום)" disabled></textarea>
    </div>

    <div class="checkbox-container">
      <input type="checkbox" id="diffPlace" /> יש לי חבילה נוספת ממקום אחר<br />
      <textarea id="sms3" placeholder="הודעת SMS נוספת (ממקום אחר)" disabled></textarea>
    </div>

    <label>📦 המוצר רגיש (שביר, קפוא וכו')<textarea id="note"></textarea></label>

    <div class="tos">
      📲 לאחר חישוב התשלום, ניתן לשלם בביט למספר: 052-3285367 או לבחור לשלם במזומן לשליח. <br>
      לאחר ביצוע התשלום, השליח ייצא לדרך 🚴‍♂️
    </div>

    <button class="btn" onclick="calculateSummary()">חשב סיכום הזמנה</button>
    <div class="summary-box" id="summary"></div>

    <div class="checkbox-container">
      <label><input type="radio" name="paymentMethod" id="payBit" /> תשלום בביט</label><br>
      <label><input type="radio" name="paymentMethod" id="payCash" /> תשלום במזומן לשליח בעת קבלת החבילה</label>
    </div>

    <div class="checkbox-container">
      <input type="checkbox" id="termsConfirm" /> אני מאשר/ת שקראתי את תנאי השירות ומסכים/ה להם
    </div>

    <button class="btn" onclick="sendEmailOnly()">סיום ושלח את ההזמנה</button>

    <div class="footer">
      <h3>📜 תנאי שירות ומשלוחים</h3>
      <p>
1. הזמנת השליחות מתבצעת על אחריות הלקוח בלבד.<br>
2. השליח מבצע את השליחות מנקודת האיסוף כפי שהוזנה בטופס, ואינו אחראי על מצב החבילה שהתקבלה ממנה.<br>
3. החבילות הנמסרות לשליח סגורות ואטומות, ולכן אין באפשרותנו לבדוק או לאשר את תכולתן, תקינותן או התאמתן.<br>
4. במקרה של משלוח רגיש – חובה לעדכן אותנו מראש בטופס. ייתכן ותידרש תוספת תשלום.<br>
5. לא נישא באחריות לכל נזק ישיר או עקיף, אובדן או עיכוב הקשור בתכולת החבילה.<br>
6. השליח ייצא לדרך רק לאחר אישור תשלום בפועל או בחירת תשלום במזומן.<br>
7. איסוף החבילות מתבצע אך ורק מתוך העיר פתח תקווה.<br>
8. המסירה תתבצע במועד הקצר ביותר ככל שניתן, ולא יאוחר מ־24 שעות ממועד ההזמנה.<br>
9. בעת השארת פרטים באתר, הלקוח מסכים לקבל מאיתנו עדכונים, הצעות שיווקיות והודעות פרסומיות באמצעות דוא״ל, SMS או וואטסאפ, בהתאם לחוק. הלקוח יוכל להסיר את עצמו מרשימת התפוצה בכל עת באמצעות קישור להסרה או פנייה ישירה אלינו.<br>
10. מחירי השירותים והמשלוחים עשויים להשתנות מעת לעת, ללא צורך בהודעה מוקדמת. המחיר שיחויב בפועל הוא המחיר כפי שהוצג במועד ביצוע ההזמנה.<br>
11. אנו מתחייבים לעשות את מירב המאמצים לספק את המשלוח בהקדם האפשרי, אך איננו אחראים לעיכובים הנגרמים עקב עומסים חריגים, בעיות לוגיסטיות או אירועים שאינם בשליטתנו (כגון מזג אוויר קיצוני, תקלות במערכות השילוח וכו').<br>
12. לפניות ושירות לקוחות ניתן לפנות אלינו בכתובת: <a href="mailto:deliveryskd@gmail.com">deliveryskd@gmail.com</a><br>
      </p>
    </div>

    <p class="contact-line">
      📧 לשאלות או פניות ניתן לפנות אלינו בכתובת: 
      <a href="mailto:deliveryskd@gmail.com">deliveryskd@gmail.com</a>
    </p>
  </div>

 <script>
  (function(){ emailjs.init("DRCnw2qGu7HZ6RQ4S"); })();

  const TELEGRAM_TOKEN = "8198187646:AAGV8sbuaQIiCs1i54pNGYt4trK4YBX2wnA";
  const TELEGRAM_CHAT_ID = "7003207799";
  let latestSummary = "";

  document.addEventListener("DOMContentLoaded", () => {
    const samePlace = document.getElementById("samePlace");
    const diffPlace = document.getElementById("diffPlace");
    const sms2 = document.getElementById("sms2");
    const sms3 = document.getElementById("sms3");

    sms2.disabled = true;
    sms3.disabled = true;

    samePlace.addEventListener("change", () => {
      sms2.disabled = !samePlace.checked;
      if (!samePlace.checked) sms2.value = "";
    });

    diffPlace.addEventListener("change", () => {
      sms3.disabled = !diffPlace.checked;
      if (!diffPlace.checked) sms3.value = "";
    });
  });

  function formatEmailText(text) {
    if (!text) return "";
    return text
      .replace(/(Epost\s*\d+)/gi, "<strong>$1</strong>")
      .replace(/(EP\d{9,})/gi, "<strong>$1</strong>")
      .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
  }

  function calculateSummary() {
    const name=document.getElementById('name').value.trim();
    const phone=document.getElementById('phone').value.trim();
    const address=document.getElementById('address').value.trim();
    const extraInfo=document.getElementById('extraInfo').value.trim();
    const email=document.getElementById('email').value.trim();

    if(!name || !phone || !address || !email){
      alert("יש למלא שם, טלפון, כתובת ומייל לפני חישוב סיכום הזמנה.");
      return;
    }

    let total=25;
    if(document.getElementById('samePlace').checked) total+=5;
    if(document.getElementById('diffPlace').checked) total+=15;

    const summary=`סיכום הזמנה:\nשם: ${name}\nטלפון: ${phone}\nכתובת: ${address}\n📝 הוראות מיוחדות: ${extraInfo}\n✉️ מייל לחשבונית: ${email}\n💰 סך הכל לתשלום: ${total} ש"ח`;

    latestSummary = summary + "\nמקור ההזמנה: direct\nאופן התשלום: " + (document.getElementById('payCash').checked ? "מזומן" : "ביט");
    document.getElementById('summary').innerText = summary;
  }

  function sendTelegramMessage(message) {
   fetch("/.netlify/functions/telegram", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ message: latestSummary })
});
  }

  function sendEmailOnly() {
    if(!latestSummary){alert("נא לחשב הזמנה לפני שליחה.");return;}
    if(!document.getElementById('termsConfirm').checked){alert("יש לאשר את תנאי השירות לפני השליחה.");return;}
    if(!document.getElementById('payCash').checked && !document.getElementById('payBit').checked){
      alert("יש לבחור אמצעי תשלום – ביט או מזומן.");return;
    }

    const templateParams = {
      payment_method: document.getElementById('payCash').checked ? 'מזומן' : 'ביט',
      name: document.getElementById('name').value,
      phone: document.getElementById('phone').value,
      address: document.getElementById('address').value,
      extra_info: document.getElementById('extraInfo').value,
      email: document.getElementById('email').value,
      sms_html: formatEmailText(document.getElementById('sms').value),
      sms2_html: formatEmailText(document.getElementById('sms2').value),
      sms3_html: formatEmailText(document.getElementById('sms3').value),
      note: document.getElementById('note').value,
      total: latestSummary.match(/\d+/g).slice(-1)[0]
    };

    emailjs.send('service_g3p8ge4','template_hm0ojvh',templateParams)
      .then(() => {
        const clientParams = {
          to_name: document.getElementById('name').value,
          to_email: document.getElementById('email').value,
          total: latestSummary.match(/\d+/g).slice(-1)[0],
          payment_method: document.getElementById('payCash').checked ? 'מזומן' : 'ביט',
          address: document.getElementById('address').value,
          extra_info: document.getElementById('extraInfo').value,
          sms_html: formatEmailText(document.getElementById('sms').value),
          sms2_html: formatEmailText(document.getElementById('sms2').value),
          sms3_html: formatEmailText(document.getElementById('sms3').value),
        };

        emailjs.send('service_g3p8ge4','template_uc1juu9',clientParams)
          .then(() => alert("✅ ההזמנה נשלחה בהצלחה!"))
          .catch(error => alert("❌ שגיאה בשליחת מייל ללקוח: " + JSON.stringify(error)));

        // ✅ שולח התראה לטלגרם
        sendTelegramMessage(latestSummary);

      })
      .catch(error => alert("❌ שגיאה בשליחת המייל הראשי: " + JSON.stringify(error)));
  }
</script>

</body>
</html>
